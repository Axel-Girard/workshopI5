webpackJsonpvivocha([18],{163:function(t,n,o){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}for(var i,c=o(6),a=e(c),r=(o(19),o(141)),s=o(213),u={options:{debugMode:!1},agent:null,console:{},locationHandler:null,version:1},f=function(){return"object"===(0,a.default)(r.getContact())&&!r.getContact().hasLeft},g=["log","debug","info","warn","error"],d=0;d<g.length;d++)u.console[g[d]]=function(t){return function(){if(u.options.debugMode){var n=Array.prototype.slice.call(arguments,0);n.unshift("Vivocha API -"),r.console[t].apply(r.console[t],n)}}}(g[d]);u.log=u.console.log,u.getOptions=function(){return u.options},u.setOptions=function(t){return"object"===("undefined"==typeof t?"undefined":(0,a.default)(t))&&r.$.extend(u.options,t),u.options},u.setPreroutingHandler=function(t,n){try{if("function"!=typeof t)throw"no function specified";if(n)u.console.info("setting routing tags function on service",n),r.services[n].preRouting=t;else for(var o in r.services)r.services[o].preRouting=t}catch(t){u.console.warn("unable to set routing tags function on",n,t)}},u.sendText=function(t){try{if(!f()||!r.getContact().assigned)throw"contact not found";r.getContact().sendText(t)}catch(t){u.console.warn("sendMessage: ",t)}},u.getContactInfo=function(){var t=null;try{if(!f())throw"contact not found";t=r.getContact().contact}catch(t){u.console.warn("getContactState: ",t)}return t},u.getAgentInfo=function(){var t=null;try{if(!(f()&&r.getContact().assigned&&u.agent))throw"agent not found";t=u.agent}catch(t){u.console.warn("getAgentInfo: ",t)}return t},u.getDebugMode=function(){return u.debugMode},u.setDebugMode=function(t){return u.debugMode=t===!0,u.debugMode},u.setNickname=function(){return r.setNickname.apply(r,arguments)},u.getNickname=function(){return r.getNickname.apply(r,arguments)},u.setData=function(){return r.setData.apply(r,arguments)},u.getData=function(){return r.getData.apply(r,arguments)},u.setContactColor=function(){return r.setContactColor.apply(r,arguments)},u.getContactColor=function(){return r.getContactColor.apply(r,arguments)},u.setContactPriority=function(){return r.setContactPriority.apply(r,arguments)},u.getContactPriority=function(){return r.getContactPriority.apply(r,arguments)},u.setWidgetHandler=function(t){r.events.on("widget",setWidgetHandler)},u.setLocationHandler=function(t){try{if("function"!=typeof t)throw"no function specified";u.locationHandler=r.locationHandler=t,i&&i.setLocationHandler(t)}catch(t){u.console.warn("unable to set custom location handler function",t)}},u.sendLocationChange=function(){try{if(!f()||!r.getContact().assigned)throw"action handler not found";i.sendLocation()}catch(t){u.console.warn("sendLocationChange: ",t)}},u.sendFormUpdate=function(){try{if(!f()||!r.getContact().assigned)throw"action handler not found";i.sendForms()}catch(t){u.console.warn("sendFormUpdate: ",t)}},u.addAction=function(){try{if(f())return i.addAction.apply(i,arguments);throw"action handler not found"}catch(t){u.console.warn("addAction: ",t)}},u.sendAction=function(t,n){try{if(f()&&r.getContact().assigned&&"function"==typeof i["send"+t])return i["send"+t].apply(i,[n]);throw"action handler not found"}catch(t){u.console.warn("sendAction: ",t)}},u.setAgentInfo=function(){var t=r.getContact();t&&t.contact&&t.contact.agentInfo&&(u.agent={id:t.contact.agentInfo.id,nick:t.contact.agentInfo.nick})},u.events=r.$({}),r.events.on("log",function(t,n){u.events.trigger("onLog",arguments)}),r.events.on("contact",function(t){return t?(u.agent=null,t.contact.agentInfo&&(u.agent={id:t.contact.agentInfo.id,nick:t.contact.agentInfo.nick}),t.on("text",function(){u.events.trigger("onMessage",arguments)}),t.on("localtext",function(n){r.getVVCU().then(function(o){var e=[n.body,o,t.nick];u.events.trigger("onMessage",e)})}),t.on("link",function(){u.events.trigger("onLink",arguments)}),t.on("locallink",function(n){r.getVVCU().then(function(o){var e=[n.url,o,t.nick,n.desc];u.events.trigger("onLink",e)})}),t.on("iswriting",function(){u.events.trigger("onWriting",arguments)}),t.on("localiswriting",function(){r.getVVCU().then(function(n){var o=[n,t.nick];u.events.trigger("onWriting",o)})}),t.on("joined",function(t){t.vvcu||(u.agent={id:t.user,nick:t.nick})}),i=new s(t),"function"==typeof u.locationHandler&&(i.setLocationHandler(u.locationHandler),i.sendLocation()),void u.events.trigger("onContact",arguments)):void u.console.warn("contact not found")}),u.setAgentInfo(),r.api=u,r.api.ready=!0},213:function(t,n,o){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}var i=o(6),c=e(i),a=o(18);a.$=o(30);var r=function(t){if("object"!==("undefined"==typeof t?"undefined":(0,c.default)(t)))throw"bad arguments";var n=this;n.target=a.$(document),n.contact=t,n.contact.on("action",function(){n.onAction.apply(n,arguments)})};r.prototype.addAction=function(t,n){if(a.console.log("VivochaAction::addAction ",arguments),"function"==typeof this["on"+t]||"function"==typeof this["send"+t])return void a.console.warn("VivochaAction::addAction action "+t+"already exists");var o=this;return this["on"+t]=n,this["send"+t]=function(n){o.sendAction(t,n)},this["send"+t]},r.prototype.onAction=function(t,n,o,e,i){if(a.console.log("VivochaAction::onAction ",arguments),this.isAgent&&i)return void a.console.info("VivochaAction::onAction: ignoring action generated by myself");try{if("function"!=typeof this["on"+t])throw"unknown action requested";this["on"+t].apply(this,n||[])}catch(t){a.console.warn(t)}},r.prototype.sendAction=function(t,n){a.console.log("VivochaAction::sendAction ",arguments),this.contact.sendAction(t,n)},r.prototype.setLocationHandler=function(t){a.log("VivochaAction::setLocationHandler");try{if("function"!=typeof t)throw"no function specified";this.locationHandler=t}catch(t){a.log("VivochaAction::setLocationHandler",t)}},r.prototype.onLocation=function(t){t||(a.log("VivochaAction::onLocation"),this.sendLocation())},r.prototype.sendLocation=function(){a.log("VivochaAction::sendLocation");var t=this.getTargetDocument(this.target),n={title:t.title,uri:t.location.href,ts:{sec:0,usec:1e3*(new Date).getTime()}};if("function"==typeof this.locationHandler)try{var o=this.locationHandler(n);if(!o)throw"no location object provided";n=o}catch(t){a.log("VivochaAction::setLocationHandler",t)}this.contact.request("locationchange",n)},r.prototype.getTargetDocument=function(){var t=this.target.get(0),n=this.target.get(0),o=0;try{for(;!t.hasOwnProperty("location");)t=t.parentNode,o++;a.log("VivochaAction::getTargetDocument target document found: ",t," after "+o+" iteractions"),n=t}catch(t){a.console.error("VivochaAction::getTargetDocument error getting target document from ",this.target," fails after "+o+" iteractions, cause: ",t)}return n},t.exports=r}});
//# sourceMappingURL=vivocha_api.js.map